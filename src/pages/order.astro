---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allProducts = await getCollection('products');
const availableProducts = allProducts.filter(p => p.data.available);

// Get selected product from URL parameter
const url = new URL(Astro.request.url);
const selectedProductSlug = url.searchParams.get('product');
---

<BaseLayout
  title="Order Form - Crocheted Animals"
  description="Place your order for a handcrafted crocheted animal. Made with love and premium materials."
>
  <section class="py-16 md:py-24">
    <div class="container mx-auto px-4">
      <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12">
          <h1 class="font-serif text-4xl md:text-5xl font-bold text-stone-800 mb-4">
            Place Your Order
          </h1>
          <p class="text-lg text-stone-600">
            Fill out the form below and we'll get started on your handcrafted companion!
          </p>
        </div>

        <!-- Order Form -->
        <form
          name="order"
          method="POST"
          data-netlify="true"
          netlify-honeypot="bot-field"
          class="bg-white rounded-lg shadow-lg p-8"
        >
          <!-- Netlify Form Setup -->
          <input type="hidden" name="form-name" value="order" />
          <p class="hidden">
            <label>
              Don't fill this out if you're human: <input name="bot-field" />
            </label>
          </p>

          <!-- Product Selection -->
          <div class="mb-6">
            <label for="product" class="block text-sm font-semibold text-stone-700 mb-2">
              Select Product <span class="text-rose-600">*</span>
            </label>
            <select
              id="product"
              name="product"
              required
              class="w-full px-4 py-3 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
            >
              <option value="">Choose a product...</option>
              {availableProducts.map((product) => (
                <option
                  value={`${product.data.name} - $${product.data.price}`}
                  selected={product.slug === selectedProductSlug}
                >
                  {product.data.name} - ${product.data.price.toFixed(2)}
                </option>
              ))}
            </select>
          </div>

          <!-- Quantity -->
          <div class="mb-6">
            <label for="quantity" class="block text-sm font-semibold text-stone-700 mb-2">
              Quantity <span class="text-rose-600">*</span>
            </label>
            <input
              type="number"
              id="quantity"
              name="quantity"
              min="1"
              value="1"
              required
              class="w-full px-4 py-3 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
            />
          </div>

          <!-- Customer Name -->
          <div class="mb-6">
            <label for="name" class="block text-sm font-semibold text-stone-700 mb-2">
              Full Name <span class="text-rose-600">*</span>
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full px-4 py-3 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
              placeholder="John Doe"
            />
          </div>

          <!-- Email -->
          <div class="mb-6">
            <label for="email" class="block text-sm font-semibold text-stone-700 mb-2">
              Email Address <span class="text-rose-600">*</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-3 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
              placeholder="john@example.com"
            />
          </div>

          <!-- Phone -->
          <div class="mb-6">
            <label for="phone" class="block text-sm font-semibold text-stone-700 mb-2">
              Phone Number
            </label>
            <input
              type="tel"
              id="phone"
              name="phone"
              class="w-full px-4 py-3 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
              placeholder="(555) 123-4567"
            />
          </div>

          <!-- Shipping Address -->
          <div class="mb-6">
            <label for="address" class="block text-sm font-semibold text-stone-700 mb-2">
              Shipping Address <span class="text-rose-600">*</span>
            </label>
            <textarea
              id="address"
              name="address"
              required
              rows="3"
              class="w-full px-4 py-3 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
              placeholder="123 Main Street&#10;City, State 12345&#10;Country"
            ></textarea>
          </div>

          <!-- Special Instructions -->
          <div class="mb-6">
            <label for="instructions" class="block text-sm font-semibold text-stone-700 mb-2">
              Special Instructions or Customizations
            </label>
            <textarea
              id="instructions"
              name="instructions"
              rows="4"
              class="w-full px-4 py-3 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent"
              placeholder="Any color preferences, customizations, or special requests..."
            ></textarea>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            class="w-full bg-rose-600 text-white px-8 py-4 rounded-lg font-semibold hover:bg-rose-700 transition-colors shadow-lg hover:shadow-xl"
          >
            Submit Order
          </button>

          <!-- Info Box -->
          <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <p class="text-sm text-blue-800">
              <strong>Next Steps:</strong> After submitting, we'll send you an email with payment
              instructions and confirm your order details. We accept PayPal, Venmo, and Zelle.
            </p>
          </div>
        </form>
      </div>
    </div>
  </section>
</BaseLayout>
